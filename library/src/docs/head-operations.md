#Сервис получения информации о портфеле по конкретному счёту

##Получение списка операций по счёту

В процессе работы торговому роботу требуется получать информацию об операциях по счёту. Например, чтобы
корректно рассчитывать доходности и собирать статистику своей работы. Для реализации данных потребностей
можно использовать метод [getOperations](/investAPI/operations#getoperations), а так же более новый метод [getOperationsByCursor](/investAPI/operations#getoperationsbycursor).

Метод [getOperationsByCursor](/investAPI/operations#getoperationsbycursor) является более предпочтительным для использования, возвращает список всех операций по указанному счету.
Данный метод возвращает информацию обо всех операциях, в том числе отмененных, поддерживает пагинацию и расширенную фильтрацию. 
Плюс обладает всеми преимуществами метода [getOperations](/investAPI/operations#getoperations).

Метод [getOperations](/investAPI/operations#getoperations), в том числе, возвращает отменённые операции (параметр *state*), это нужно обязательно учитывать
в алгоритме работы. 

Команда TINKOFF INVEST API не рекомендует использовать метод получения операций для идентификации изменения
статусов торговых поручений, т.к. некоторые операции могут происходить с задержкой относительно реального
исполнения. Для получения статусов исполнения торговых поручений рекомендуется использовать соответствующий
stream [сервиса работы с торговыми поручениями](/investAPI/head-orders/). 


##Получение портфолио

Для получения торговым роботом текущего состояния портфеля по счёту используется метод [getPortfolio](/investAPI/operations#getportfolio).
Данный метод в отличие от метода [getPositions](/investAPI/operations#getpositions) 
возвращает также статистическую информацию по портфелю (абсолютные и относительные доходности, текущую 
стоимость активов и т.п.).

Обратите внимание, что для расчёта суммарной стоимости активов используются текущие цены биржевых
инструментов. Если торги в данный момент не ведутся, то берётся цена закрытия последней торговой 
сессии. 

В данный метод добавлен булев параметр `blocked`, принимающем значение *true* если инструмент заблокирован депозитарием.

**Значения средних цен покупки инструментов (параметры *average_position_price*, *average_position_price_pt* и 
*average_position_price_fifo*) рассчитываются асинхронно. Возможна задержка в пересчёте до одной секунды.**

##Получение списка позиций портфеля по счёту

Для принятия решений торговому роботу требуется получать список актуальных позиций в портфеле, т.е. 
количество ценных бумаг, валютных позиций по счёту, включая заблокированные средства. Для этого используется
метод [getPositions](/investAPI/operations#getpositions). Команда TINKOFF 
INVEST API рекомендует использовать именно этот метод, когда требуется получить актуальный список позиций, 
т.к. он является более быстрым и "лёгким" по сравнению с методом получения портфолио. 

В данном методе так же возвращается тип инструмента для списка ценно-бумажных позиций портфеля в параметре `instrument_type`.

В данный метод добавлен булев параметр `exchange_blocked`, принимающем значение *true* если инструмент заблокирован депозитарием.

**Важно**. Данный метод не возвращает объём средств, заблокированных под гарантийное обеспечение фьючерсов. Для 
получения этой информации воспользуйтесь методом [getWithdrawLimits](/investAPI/operations#getwithdrawlimits). 

##Получение доступного остатка для вывода денежных средств

Метод [getWithdrawLimits](/investAPI/operations#getwithdrawlimits) позволяет в 
удобном виде получить доступный для вывода баланс денежных средств, а также количество заблокированных 
валютных позиций. 

##Получение различных отчётов 

TINKOFF INVEST API позволяет получать различные отчёты. Например, [брокерский отчёт](/investAPI/operations#getbrokerreport)
или [справка о доходах за пределами РФ](/investAPI/operations#getdividendsforeignissuer). Обратите внимание,
что операции формирования отчётов достаточно трудоёмки, поэтому существуют ограничения на период 
формирования отчёта и лимиты на количество вызовов соответствующих методов. 

##Подписка на стрим позиций и доходностей портфеля

Для получения сделок с биржи так же можно подписаться на gRPC server-side stream [PortfolioStream](/investAPI/operations/#portfoliostream).
Стрим позиций и доходностей портфеля возвращает статистическую информацию по портфелю (абсолютные и относительные доходности, текущую
стоимость активов и т.п.).

Средневзвешенная цена позиции, текущая рассчитанная доходность, текущая цена инструмента, средняя цена лота в позиции по методу FIFO - 
возвращаются в валюте инструмента.

Средняя цена лота в позиции в пунктах (для фьючерсов) - возвращает количество в пунктах. 

